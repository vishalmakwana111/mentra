# Frontend AI Query Panel & Node Highlighting Tasks

This file outlines the tasks required to implement an AI query panel in the frontend, connect it to the semantic search API, and highlight the corresponding nodes on the React Flow canvas.

- [X] **Layout Modification**
    - [X] Modify `DashboardLayout.tsx` (or `app/page.tsx`) to include a third column area on the right.
    - [X] Ensure the three-column layout (Side Panel | Main Canvas | Query Panel) is responsive.
- [ ] **Create Query Panel Component**
    - [X] Create directory `frontend/src/components/ai/`.
    - [X] Create file `frontend/src/components/ai/QueryPanel.tsx`.
    - [X] Add basic structure (e.g., `div` container, heading).
    - [X] Add the `<QueryPanel />` component to the right column in the main layout.
- [ ] **Query Input Implementation**
    - [X] Add a text input/textarea and a submit button to `QueryPanel.tsx`.
    - [X] Use `useState` to manage the query input value.
- [ ] **API Service Function**
    - [X] Define frontend types for `SearchMatch` and `SearchResponse` in `frontend/src/types/index.ts` (matching backend schemas/ai.py).
    - [X] Add `searchNotesApi(query: string, top_k: number = 5): Promise<SearchResponse>` function to `frontend/src/services/api.ts`.
    - [X] Ensure it calls `GET /api/v1/ai/search-notes` with query parameters.
- [ ] **State Management (Zustand Store)**
    - [X] Create file `frontend/src/store/searchStore.ts`.
    - [X] Define the store state: `searchResults: SearchMatch[]`, `highlightedNodeIds: string[]`, `isLoading: boolean`, `error: string | null`.
    - [X] Implement `performSearch(query: string)` action:
        - [X] Set `isLoading` to true, clear previous results/error.
        - [X] Call `searchNotesApi`.
        - [X] On success: update `searchResults`, extract vector IDs (like `note_XX`) from results, update `highlightedNodeIds`, set `isLoading` to false.
        - [X] On error: update `error`, set `isLoading` to false, clear results/highlights.
    - [X] Implement `clearSearch()` action to reset state (results, highlights, error).
- [ ] **Connect Query Panel to Store**
    - [X] In `QueryPanel.tsx`, import and use the `useSearchStore` hook.
    - [X] On form submit, call the `performSearch` action.
    - [X] Display loading state (e.g., disable button, show spinner).
    - [X] Display error message from store if `error` is not null.
    - [X] Render the `searchResults` from the store (e.g., list item for each match showing metadata.title and score).
    - [X] Add a "Clear" button that calls the `clearSearch` action.
- [ ] **Node Highlighting Implementation**
    - [X] In `MindMapCanvas.tsx` (or relevant custom node component), import and use `useSearchStore`.
    - [X] Access the `highlightedNodeIds` array from the store.
    - [X] In the node mapping/rendering logic, determine if the current node's `id` is present in `highlightedNodeIds`.
    - [X] Apply conditional styling (e.g., using `clsx` or ternary operators in `className`) based on whether the node is highlighted. Choose a distinct style (e.g., bright border, background pulse).
    - [X] Ensure default styling applies when `highlightedNodeIds` is empty or the node ID is not present.
- [ ] **Testing**
    - [ ] Verify the three-column layout appears correctly.
    - [ ] Enter a query in the panel and submit.
    - [ ] Verify loading state appears.
    - [ ] Verify search results are displayed in the right panel.
    - [ ] Verify the corresponding nodes on the canvas get highlighted.
    - [ ] Verify highlights disappear when "Clear Search" is clicked or a new search is performed.
    - [ ] Test with queries that return no results.
    - [ ] Test error handling (e.g., if the API call fails). 