# Task: Synchronize GraphNode Creation/Deletion with Notes/Files

- [x] 1.  **Add `graph_node_id` FK to Models:**
    - [x] Add `graph_node_id = Column(Integer, ForeignKey("graph_nodes.id"), nullable=True)` to `app/models/note.py`.
    - [x] Add `graph_node_id = Column(Integer, ForeignKey("graph_nodes.id"), nullable=True)` to `app/models/file.py`.
- [x] 2.  **Database Migration for FKs:**
    - [x] Run `alembic revision --autogenerate -m "Add graph_node_id FK to notes and files"`.
    - [x] Review the generated migration script.
    - [x] Apply the migration: `alembic upgrade head`.
- [x] 3.  **Modify `crud_note.create_note`:**
    - [x] After a `Note` object is prepared but *before* commit, call `crud_graph.create_graph_node` (`node_type='note'`).
    - [x] Assign the returned `graph_node.id` to the `note.graph_node_id`.
    - [x] Commit the session (saves both `Note` and linked `GraphNode`).
- [x] 4.  **Modify `crud_file.create_file_record`:**
    - [x] After a `File` object is prepared but *before* commit, call `crud_graph.create_graph_node` (`node_type='file'`).
    - [x] Assign the returned `graph_node.id` to the `file.graph_node_id`.
    - [x] Commit the session.
- [x] 5.  **Modify `crud_note.delete_note`:**
    - [x] Get the `note_to_delete`.
    - [x] If found and `note_to_delete.graph_node_id` exists, store the `graph_node_id`.
    - [x] Delete the `note_to_delete`.
    - [x] If a `graph_node_id` was stored, call `crud_graph.delete_graph_node` with that ID.
- [x] 6.  **Modify `crud_file.delete_file_record`:**
    - [x] Get the `file_to_delete`.
    - [x] If found and `file_to_delete.graph_node_id` exists, store the `graph_node_id`.
    - [x] Delete the `file_to_delete`.
    - [x] If a `graph_node_id` was stored, call `crud_graph.delete_graph_node` with that ID.
